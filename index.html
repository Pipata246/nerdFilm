<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nerdFilm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
        }

        header {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: -0.5px;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        h1:hover {
            opacity: 0.8;
        }

        .nav-menu {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .search-bar {
            display: flex;
            align-items: center;
        }

        input[type="search"] {
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 0.95rem;
                
            width: 300px;
            transition: all 0.3s ease;
        }

        input[type="search"]:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 3rem;
        }

        .filters-sidebar {
            background: rgba(20, 20, 20, 0.6);
            border-radius: 12px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .filters-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group {
            margin-bottom: 2rem;
        }

        .filter-group-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #ccc;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s ease;
            margin-bottom: 0.5rem;
        }

        .filter-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .filter-option input[type="checkbox"],
        .filter-option input[type="radio"] {
            cursor: pointer;
        }

        .filter-option label {
            cursor: pointer;
            color: #e0e0e0;
            font-size: 0.9rem;
            flex: 1;
        }

        .filter-range {
            width: 100%;
            margin-top: 0.5rem;
        }

        .filter-range input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #888;
            margin-top: 0.5rem;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .filter-btn-action {
            flex: 1;
            padding: 0.6rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn-apply {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border-color: rgba(76, 175, 80, 0.3);
        }

        .filter-btn-apply:hover {
            background: rgba(76, 175, 80, 0.3);
        }

        .filter-btn-reset {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border-color: rgba(244, 67, 54, 0.3);
        }

        .filter-btn-reset:hover {
            background: rgba(244, 67, 54, 0.3);
        }

        .content-area {
            min-width: 0;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 2rem;
        }

        .movie-card {
            background: rgba(20, 20, 20, 0.6);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .movie-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .movie-poster {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }

        .movie-info {
            padding: 1rem;
        }

        .movie-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #888;
        }

        .movie-year {
            color: #999;
        }

        .movie-rating {
            background: rgba(255, 193, 7, 0.15);
            color: #ffc107;
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: 0.6rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 40px;
        }

        .pagination-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .pagination-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            color: #fff;
        }

        .pagination-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .pagination-info {
            color: #888;
            font-size: 0.9rem;
            padding: 0 1rem;
        }

        @media (max-width: 1024px) {
            main {
                grid-template-columns: 1fr;
            }

            .filters-sidebar {
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
                width: 100%;
            }

            .nav-btn {
                font-size: 0.85rem;
                padding: 0.5rem 1rem;
            }

            .search-bar {
                width: 100%;
            }

            input[type="search"] {
                width: 100%;
            }

            .movies-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1 onclick="window.location.href='index.html'">üé¨ nerdFilm</h1>
            
            <div class="nav-menu">
                <a href="index.html" class="nav-btn active">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="#" class="nav-btn" onclick="filterByCategory('new'); return false;">üÜï –ù–æ–≤–∏–Ω–∫–∏</a>
                <a href="#" class="nav-btn" onclick="filterByCategory('popular'); return false;">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</a>
                <a href="genres.html" class="nav-btn">üé≠ –ñ–∞–Ω—Ä—ã</a>
            </div>

            <div class="search-bar">
                <input type="search" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤...">
            </div>
        </div>
    </header>

    <main>
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ -->
        <aside class="filters-sidebar">
            <h2 class="filters-title">üîç –§–∏–ª—å—Ç—Ä—ã</h2>

            <!-- –ñ–∞–Ω—Ä—ã -->
            <div class="filter-group">
                <div class="filter-group-title">–ñ–∞–Ω—Ä—ã</div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-action" value="Action">
                    <label for="genre-action">–ë–æ–µ–≤–∏–∫–∏</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-comedy" value="Comedy">
                    <label for="genre-comedy">–ö–æ–º–µ–¥–∏–∏</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-drama" value="Drama">
                    <label for="genre-drama">–î—Ä–∞–º—ã</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-scifi" value="Sci-Fi">
                    <label for="genre-scifi">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-thriller" value="Thriller">
                    <label for="genre-thriller">–¢—Ä–∏–ª–ª–µ—Ä—ã</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-horror" value="Horror">
                    <label for="genre-horror">–£–∂–∞—Å—ã</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-romance" value="Romance">
                    <label for="genre-romance">–ú–µ–ª–æ–¥—Ä–∞–º—ã</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="genre-animation" value="Animation">
                    <label for="genre-animation">–ê–Ω–∏–º–∞—Ü–∏—è</label>
                </div>
            </div>

            <!-- –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ -->
            <div class="filter-group">
                <div class="filter-group-title">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</div>
                <div class="filter-range">
                    <input type="range" id="yearMin" min="1940" max="2024" value="1940" step="1">
                    <div class="range-values">
                        <span id="yearMinValue">1940</span>
                        <span>‚Äî</span>
                        <span id="yearMaxValue">2024</span>
                    </div>
                    <input type="range" id="yearMax" min="1940" max="2024" value="2024" step="1">
                </div>
            </div>

            <!-- –†–µ–π—Ç–∏–Ω–≥ -->
            <div class="filter-group">
                <div class="filter-group-title">–†–µ–π—Ç–∏–Ω–≥ IMDb</div>
                <div class="filter-range">
                    <input type="range" id="ratingMin" min="0" max="10" value="0" step="0.1">
                    <div class="range-values">
                        <span id="ratingMinValue">0.0</span>
                        <span>‚Äî</span>
                        <span>10.0</span>
                    </div>
                </div>
            </div>

            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
            <div class="filter-group">
                <div class="filter-group-title">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
                <div class="filter-option">
                    <input type="radio" name="sort" id="sort-rating" value="rating" checked>
                    <label for="sort-rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</label>
                </div>
                <div class="filter-option">
                    <input type="radio" name="sort" id="sort-year" value="year">
                    <label for="sort-year">–ü–æ –≥–æ–¥—É</label>
                </div>
                <div class="filter-option">
                    <input type="radio" name="sort" id="sort-title" value="title">
                    <label for="sort-title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
                </div>
            </div>

            <!-- –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
            <div class="filter-group">
                <div class="filter-group-title">–ü–æ—Ä—è–¥–æ–∫</div>
                <div class="filter-option">
                    <input type="radio" name="order" id="order-desc" value="desc" checked>
                    <label for="order-desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</label>
                </div>
                <div class="filter-option">
                    <input type="radio" name="order" id="order-asc" value="asc">
                    <label for="order-asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</label>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="filter-buttons">
                <button class="filter-btn-action filter-btn-apply" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <button class="filter-btn-action filter-btn-reset" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </aside>

        <!-- –û–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
        <div class="content-area">
            <div class="movies-grid" id="moviesGrid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤...</div>
            </div>
            
            <div class="pagination" id="pagination"></div>
        </div>
    </main>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ -->
    <script src="movies-data.js"></script>
    
    <script>
        // OMDb API –∫–ª—é—á (–ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞ http://www.omdbapi.com/apikey.aspx)
        const OMDB_API_KEY = '814703d8'; // –í–∞—à –∫–ª—é—á
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑—É –∏–∑ 100 —Ñ–∏–ª—å–º–æ–≤
        const movies = moviesDatabase;

        // –ö—ç—à –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤
        const posterCache = {};
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–±–∏–ª—å–Ω–æ–µ –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–æ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–¥–∏–º—ã—Ö —Ñ–∏–ª—å–º–æ–≤
        async function loadPostersForMovies(moviesToLoad) {
            const promises = moviesToLoad.map(async (movie) => {
                // –ï—Å–ª–∏ –ø–æ—Å—Ç–µ—Ä —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                if (posterCache[movie.imdbId]) {
                    movie.poster = posterCache[movie.imdbId].poster;
                    movie.gradient = posterCache[movie.imdbId].gradient;
                    return;
                }

                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                    const apiUrl = isMobile 
                        ? `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://www.omdbapi.com/?i=${movie.imdbId}&apikey=${OMDB_API_KEY}`)}`
                        : `https://www.omdbapi.com/?i=${movie.imdbId}&apikey=${OMDB_API_KEY}`;
                    
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    
                    if (data.Poster && data.Poster !== 'N/A') {
                        movie.poster = data.Poster;
                        posterCache[movie.imdbId] = { 
                            poster: data.Poster, 
                            gradient: null,
                            genres: data.Genre ? data.Genre.split(', ') : []
                        };
                    } else {
                        movie.poster = null;
                        const gradient = `linear-gradient(135deg, #${Math.floor(Math.random()*16777215).toString(16)} 0%, #${Math.floor(Math.random()*16777215).toString(16)} 100%)`;
                        movie.gradient = gradient;
                        posterCache[movie.imdbId] = { 
                            poster: null, 
                            gradient: gradient,
                            genres: data.Genre ? data.Genre.split(', ') : []
                        };
                    }
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–µ—Ä–∞ –¥–ª—è ${movie.title}:`, error);
                    movie.poster = null;
                    const gradient = "linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%)";
                    movie.gradient = gradient;
                    posterCache[movie.imdbId] = { poster: null, gradient: gradient, genres: [] };
                }
            });

            await Promise.all(promises);
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã
            filters.genres = [];
            document.querySelectorAll('.filter-group input[type="checkbox"]:checked').forEach(checkbox => {
                filters.genres.push(checkbox.value);
            });

            // –ì–æ–¥
            filters.yearMin = parseInt(document.getElementById('yearMin').value);
            filters.yearMax = parseInt(document.getElementById('yearMax').value);

            // –†–µ–π—Ç–∏–Ω–≥
            filters.ratingMin = parseFloat(document.getElementById('ratingMin').value);

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            filters.sortBy = document.querySelector('input[name="sort"]:checked').value;
            filters.sortOrder = document.querySelector('input[name="order"]:checked').value;

            currentPage = 1;
            renderMovies();
        }

        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã
            document.querySelectorAll('.filter-group input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≥–æ–¥
            document.getElementById('yearMin').value = 1940;
            document.getElementById('yearMax').value = 2024;
            document.getElementById('yearMinValue').textContent = '1940';
            document.getElementById('yearMaxValue').textContent = '2024';

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥
            document.getElementById('ratingMin').value = 0;
            document.getElementById('ratingMinValue').textContent = '0.0';

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            document.getElementById('sort-rating').checked = true;
            document.getElementById('order-desc').checked = true;

            filters = {
                genres: [],
                yearMin: 1940,
                yearMax: 2024,
                ratingMin: 0,
                sortBy: 'rating',
                sortOrder: 'desc'
            };

            currentPage = 1;
            renderMovies();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
        document.getElementById('yearMin').addEventListener('input', (e) => {
            document.getElementById('yearMinValue').textContent = e.target.value;
        });

        document.getElementById('yearMax').addEventListener('input', (e) => {
            document.getElementById('yearMaxValue').textContent = e.target.value;
        });

        document.getElementById('ratingMin').addEventListener('input', (e) => {
            document.getElementById('ratingMinValue').textContent = parseFloat(e.target.value).toFixed(1);
        });

        const moviesGrid = document.getElementById('moviesGrid');
        const searchInput = document.getElementById('searchInput');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const paginationContainer = document.getElementById('pagination');

        let currentFilter = 'all';
        let searchQuery = '';
        let currentPage = 1;
        const moviesPerPage = 20;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        let filters = {
            genres: [],
            yearMin: 1940,
            yearMax: 2024,
            ratingMin: 0,
            sortBy: 'rating',
            sortOrder: 'desc'
        };

        async function renderMovies() {
            let filteredMovies = movies.filter(movie => {
                const matchesFilter = currentFilter === 'all' || movie.category === currentFilter;
                const matchesSearch = movie.title.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesYear = movie.year >= filters.yearMin && movie.year <= filters.yearMax;
                const matchesRating = movie.rating >= filters.ratingMin;
                
                return matchesFilter && matchesSearch && matchesYear && matchesRating;
            });

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∂–∞–Ω—Ä–∞–º (–±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API)
            if (filters.genres.length > 0) {
                const genreFilteredMovies = [];
                for (let movie of filteredMovies) {
                    if (posterCache[movie.imdbId] && posterCache[movie.imdbId].genres) {
                        const movieGenres = posterCache[movie.imdbId].genres;
                        const hasGenre = filters.genres.some(genre => movieGenres.includes(genre));
                        if (hasGenre) {
                            genreFilteredMovies.push(movie);
                        }
                    } else {
                        genreFilteredMovies.push(movie); // –í–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å–º—ã –±–µ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤
                    }
                }
                filteredMovies = genreFilteredMovies;
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            filteredMovies.sort((a, b) => {
                let comparison = 0;
                if (filters.sortBy === 'rating') {
                    comparison = b.rating - a.rating;
                } else if (filters.sortBy === 'year') {
                    comparison = b.year - a.year;
                } else if (filters.sortBy === 'title') {
                    comparison = a.title.localeCompare(b.title);
                }
                return filters.sortOrder === 'desc' ? comparison : -comparison;
            });

            if (filteredMovies.length === 0) {
                moviesGrid.innerHTML = '<div class="loading">–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                paginationContainer.innerHTML = '';
                return;
            }

            // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
            const totalPages = Math.ceil(filteredMovies.length / moviesPerPage);
            const startIndex = (currentPage - 1) * moviesPerPage;
            const endIndex = startIndex + moviesPerPage;
            const moviesToShow = filteredMovies.slice(startIndex, endIndex);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            moviesGrid.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–æ–≤...</div>';

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç–µ—Ä—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await loadPostersForMovies(moviesToShow);

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∏–ª—å–º–æ–≤
            moviesGrid.innerHTML = moviesToShow.map(movie => `
                <div class="movie-card" onclick="openMovie(${movie.id})">
                    ${movie.poster 
                        ? `<img src="${movie.poster}" alt="${movie.title}" class="movie-poster" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                           <div class="movie-poster" style="display: none; background: ${movie.gradient || 'linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%)'}; align-items: center; justify-content: center; font-size: 3rem;">üé¨</div>`
                        : `<div class="movie-poster" style="background: ${movie.gradient || 'linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%)'}; display: flex; align-items: center; justify-content: center; font-size: 3rem;">üé¨</div>`
                    }
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-meta">
                            <span class="movie-year">${movie.year}</span>
                            <span class="movie-rating">‚≠ê ${movie.rating}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            renderPagination(totalPages, filteredMovies.length);
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–∞–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderPagination(totalPages, totalMovies) {
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚óÄ</button>`;
            
            // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            if (currentPage > 3) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
                if (currentPage > 4) {
                    paginationHTML += `<span class="pagination-info">...</span>`;
                }
            }
            
            // –°—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—É—â–µ–π
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            if (currentPage < totalPages - 2) {
                if (currentPage < totalPages - 3) {
                    paginationHTML += `<span class="pagination-info">...</span>`;
                }
                paginationHTML += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
            paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>‚ñ∂</button>`;
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            const startMovie = (currentPage - 1) * moviesPerPage + 1;
            const endMovie = Math.min(currentPage * moviesPerPage, totalMovies);
            paginationHTML += `<span class="pagination-info">${startMovie}-${endMovie} –∏–∑ ${totalMovies}</span>`;
            
            paginationContainer.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            renderMovies();
        }

        function openMovie(id) {
            const movie = movies.find(m => m.id === id);
            if (movie && movie.imdbId) {
                window.location.href = `movie.html?id=${movie.imdbId}`;
            }
        }

        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value;
            currentPage = 1; // –°–±—Ä–æ—Å –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
            renderMovies();
        });

        function filterByCategory(category) {
            currentFilter = category;
            currentPage = 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –º–µ–Ω—é
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderMovies();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        renderMovies();
    </script>
</body>
</html>
